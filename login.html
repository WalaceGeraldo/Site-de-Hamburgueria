<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - The Burguer co.</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Oswald:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

    <header class="main-header">
        <div class="container">
            <h1 class="logo">The Burguer co.</h1>
            <nav class="main-nav" id="primary-navigation">
                 <ul>
                    <li><a href="index.html">Início</a></li>
                    <li><a href="cardapio.html">Cardápio</a></li>
                    <li id="nav-cadastro"><a href="cadastro.html">Cadastro</a></li>
                    <li id="nav-login"><a href="login.html" class="btn-login">Login</a></li>
                    <li id="nav-account" style="display: none;"><a href="minha-conta.html">Minha Conta</a></li>
                    <li id="nav-user" style="display: none;"><a href="minha-conta.html" id="user-email" style="color: #d9a040; margin-right: 15px;"></a></li>
                    <li id="nav-logout" style="display: none;"><a href="#" id="logout-button" class="btn-logout">Sair</a></li>
                    <li id="nav-cart"><a href="cart.html" class="btn-cart"><img src="imagens/carrinho.png" alt="Carrinho" style="width: 24px; height: 24px; vertical-align: middle;margin-top: 5px;"></a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="login-section">
        <div class="container">
            <div class="login-form-container">
                <h2 class="login-title">Acesse sua Conta</h2>

                <form id="loginForm">
                    <div class="form-group-login">
                        <label for="email-login">Email:</label>
                        <input type="email" id="email-login" name="email-login" required>
                    </div>
                    <div class="form-group-login">
                        <label for="senha-login">Senha:</label>
                        <input type="password" id="senha-login" name="senha-login" required>
                    </div>
                    <a href="#" class="forgot-password-link">Esqueceu sua senha?</a>
                    <button type="submit" class="btn-login-submit">Entrar</button>
                </form>

                 <p class="register-link" style="margin-top: 30px;">
                    Não tem uma conta? <a href="cadastro.html">Cadastre-se</a>
                </p>
            </div>
        </div>
    </main>

    <footer class="main-footer">
        <div class="container">
             <div class="footer-col footer-logo"><h3>THE BURGUER CO.</h3></div>
            <div class="footer-col"><h4>MAPA DO SITE</h4><ul><li><a href="index.html">INÍCIO</a></li><li><a href="cardapio.html">CARDÁPIO</a></li><li><a href="#">QUEM SOMOS</a></li><li><a href="cadastro.html">CADASTRO</a></li></ul></div>
            <div class="footer-col"><h4>SIGA-NOS NAS REDE SOCIAL</h4><div class="social-icons"><a href="#"><img src="imagens/icon-facebook.png" alt="Facebook"></a><a href="#"><img src="imagens/icon-instagram.png" alt="Instagram"></a><a href="#"><img src="imagens/icon-whatsapp.png" alt="WhatsApp"></a></div></div>
            <div class="footer-col"><h4>PEDIDO ONLINE</h4><ul><li><a href="#">IFOOD</a></li><li><a href="#">WHATSAPP</a></li><li><span>LIGAR: (21) 99999-9999</span></li></ul></div>
        </div>
    </footer>

    <script src="auth.js"></script>

    <script>
      const loginForm = document.getElementById('loginForm');
      if (loginForm) {
        loginForm.addEventListener('submit', async (event) => {
          event.preventDefault();
          const email = document.getElementById('email-login').value;
          const senha = document.getElementById('senha-login').value;
          if (!email || !senha) { alert('Por favor, preencha o email e a senha.'); return; }

          // Tentar login no servidor local
          try {
            const resp = await fetch('http://localhost:3000/api/login', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ email, password: senha })
            });
            const data = await resp.json();

            if (resp.ok && data.success) {
              // Chama a função global do auth.js para salvar os dados
              window.doLogin(data.token, data.email, data.name);
              
              alert('Login realizado com sucesso!');
              // Redireciona para a página de conta
              window.location.href = 'minha-conta.html'; 
              return;
            } else {
              alert('Erro no login: ' + (data.message || 'Credenciais inválidas'));
            }
          } catch (e) {
            console.error('Servidor local não disponível:', e);
            alert('Não foi possível conectar ao servidor. Tente novamente mais tarde.');
          }
        });
      }
    </script>
    
    <script>
        (function(){
            function updateCart(){
                try{ 
                    const cart = JSON.parse(localStorage.getItem('site_cart_v1')||'[]'); 
                    const count = cart.reduce((s,i)=>s+(i.qty||0),0); 
                    const el = document.getElementById('cart-count'); 
                    if(el) el.textContent = count; 
                }catch(e){}
            }
            updateCart();
            window.addEventListener('storage', updateCart);
            // Garante que rode também no DOMContentLoaded caso o auth.js seja mais rápido
            document.addEventListener('DOMContentLoaded', updateCart);
        })();
    </script>
</body>
</html>